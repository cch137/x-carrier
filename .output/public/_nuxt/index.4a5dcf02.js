import{u as b,E}from"./el-button.93ca0b71.js";import{b as T,c as $,_ as z,w as D,u as B,a as N,r as I,d as P}from"./useAuth.b129453f.js";import{f as k,u as V,g as R,o as u,h as q,w as i,r as O,n as U,i as n,j,k as F,l as A,c as g,a as c,b as l,d,m as H,F as K,q as M,t as W}from"./entry.4447adc5.js";import{_ as X}from"./nuxt-link.ee61b92e.js";import{u as Y,E as G}from"./useTitle.ece3e1fa.js";import{a as J}from"./app.36c0a517.js";import"./vue.f36acd1f.8b729626.js";const Q=T({type:{type:String,values:["primary","success","info","warning","danger",""],default:""},size:{type:String,values:$,default:""},truncated:{type:Boolean},tag:{type:String,default:"span"}}),Z=k({name:"ElText"}),ee=k({...Z,props:Q,setup(s){const a=s,t=b(),e=V("text"),p=R(()=>[e.b(),e.m(a.type),e.m(t.value),e.is("truncated",a.truncated)]);return(o,h)=>(u(),q(j(o.tag),{class:U(n(p))},{default:i(()=>[O(o.$slots,"default")]),_:3},8,["class"]))}});var te=z(ee,[["__file","/home/runner/work/element-plus/element-plus/packages/components/text/src/text.vue"]]);const ne=D(te);const f=F(!1),L=F([]);let x=!1;async function S(){if(x)return;x=!0;const s=new AbortController,a=new TextDecoder,t=async()=>{await p.read().then(async({value:o,done:h})=>{if(h){x=!1,S();return}a.decode(o)&&w(),t()})},p=(await fetch("/api/drive/event",{method:"POST",body:"{}",signal:s.signal})).body.getReader();t()}async function w(){try{const s=await $fetch("/api/drive/list",{method:"POST"});L.value=s.data,S()}catch{L.value=[]}}async function se(){f.value=!0;try{await w()}catch{}f.value=!1}async function ae(s){f.value=!0;try{const a=new FormData;if(s!==null)for(let e=0;e<s.length;e++)a.append(`${e}`,s[e]);const t=new XMLHttpRequest;t.open("POST","/api/drive/file"),t.send(a),t.upload.addEventListener("progress",e=>{console.log(e.lengthComputable,e.loaded,e.total)})}catch{}f.value=!1}async function oe(s){f.value=!0;try{await $fetch("/api/drive/file",{method:"DELETE",body:{fp:s}})}catch{}f.value=!1}function le(){return{fileList:L,isLoading:f,_refresh:w,refresh:se,uploadFiles:ae,deleteFile:oe}}const ie={class:"mt-8 flex-col flex-center"},re={key:0},ce={style:{display:"none"}},de={class:"FileList mt-8"},ue={key:0},fe={class:"text-center select-none"},pe={class:"FileItem flex justify-center items-center"},_e=["href"],me={key:1},ge=c("h1",null,"Welcome to Drive!",-1),he={class:"mt-8 text-center"},Ce=k({__name:"index",setup(s){const{isLoggedIn:a}=B(),t=le(),{isLoading:e,fileList:p}=t;async function o(v,r="Loading..."){const _=G.service({text:r});try{return await v()}finally{_.close()}}function h(){return document.querySelector(".FileUpload")}return A(a,v=>v?o(t.refresh):t.fileList.value=[]),a.value&&o(t.refresh),Y(`${J}`),(v,r)=>{const _=E,y=ne,C=X;return u(),g("div",ie,[n(a)?(u(),g("div",re,[c("div",null,[l(_,{icon:n(N),onClick:r[0]||(r[0]=m=>h().click()),loading:n(e)},{default:i(()=>[d("Upload")]),_:1},8,["icon","loading"]),l(_,{icon:n(I),onClick:r[1]||(r[1]=m=>o(n(t).refresh)),loading:n(e)},{default:i(()=>[d("Refresh")]),_:1},8,["icon","loading"]),c("form",ce,[c("input",{class:"FileUpload",type:"file",multiple:"",onChange:r[2]||(r[2]=m=>o(()=>n(t).uploadFiles(h().files)))},null,32)])]),c("div",de,[n(p).length===0?(u(),g("div",ue,[c("div",fe,[l(y,{type:"info"},{default:i(()=>[d("No files")]),_:1})])])):H("",!0),(u(!0),g(K,null,M(n(p),m=>(u(),g("div",pe,[c("a",{class:"flex-1",href:`/api/drive/file/${m}`,target:"_blank"},[l(y,{size:"large"},{default:i(()=>[d(W(m),1)]),_:2},1024)],8,_e),l(_,{class:"FileItemDeleteBtn mx-1",icon:n(P),type:"danger",plain:"",loading:n(e),onClick:ve=>o(()=>n(t).deleteFile(m))},null,8,["icon","loading","onClick"])]))),256))])])):(u(),g("div",me,[ge,c("div",he,[l(y,{size:"large"},{default:i(()=>[d("You are not logged in. ")]),_:1}),l(y,{size:"large"},{default:i(()=>[d("Please ")]),_:1}),l(C,{href:"/login"},{default:i(()=>[l(_,{size:"small",class:"HomepageLoginButton mb-1"},{default:i(()=>[d("Log In")]),_:1})]),_:1})])]))])}}});export{Ce as default};
